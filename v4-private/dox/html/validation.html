<!-- HTML header for doxygen 1.13.2-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MPQC-Docs: Maintaining and extending the validation suite</title>
<!--BEGIN PROJECT_ICON-->
<link rel="icon" href="$projecticon" type="image/x-icon" />
<!--END PROJECT_ICON-->
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<!--BEGIN COPY_CLIPBOARD-->
<script type="text/javascript" src="clipboard.js"></script>
<!--END COPY_CLIPBOARD-->
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
    <script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeDarkModeToggle.init();
        DoxygenAwesomeParagraphLink.init();
    </script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"$logosize/></td>
  <td id="projectalign">
   <div id="projectname">MPQC-Docs<span id="projectnumber">&#160;4.0.0-beta.1</span>
   </div>
   <div id="projectbrief">Massively Parallel Electronic Structure platform</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Maintaining and extending the validation suite</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Every new feature requires one or more validation tests to be accepted into MPQC. This helps to detect logic regressions and to maintain the feature as the code evolves. If there is no validation test then the feature is likely to become nonfunctional; features that are not tested regularly effectively do not exist.</p>
<h1><a class="anchor" id="validation-suite-architecture"></a>
The architecture of the validation test suite</h1>
<ul>
<li>The validation suite is contained in <code>tests/validation</code>, with the the test inputs and outputs located under <code>tests/validation/reference/inputs</code> and <code>tests/validation/reference/outputs</code>, respectively.</li>
<li>The main body of test suite is set up in <code>tests/validation/CMakeLists.txt</code> and other CMake scripts in this directory. Every MPQC module that needs validation tests specifies them by invoking macro <code>add_mpqc_library_tests</code>; this should occur alongside the module target definitions.</li>
<li>If some tests are to be excluded they should be listed in <code>tests/validation/CTestCustom.cmake</code>; you should not normally need to modify this file.</li>
<li>Test runner is defined in <code>tests/validation/test.cmake</code>; this is a CMake script that checks if this test is not supported by the configuration of the MPQC executable (see <code>MPQC_FEATURES</code> CMake variable), runs the tests, invokes the validator (see next), and signals the result to the user. You should not need to modify this file.</li>
<li>Validator is defined in <code>tests/validation/check.py</code>. You will need to modify this file if you add a test whose target property is not one of the currently supported properties.</li>
</ul>
<p>The following targets execute validation tests:</p><ul>
<li><code>check_validation</code> runs short-duration (see below) validation tests only; this is the target invoked by the top-level target <code>check</code>.</li>
<li><code>check_validation_full</code> runs all validation tests</li>
<li><code>check_validation_long</code> runs long-duration validation tests only</li>
</ul>
<p>It may be useful to execute a specific validation test during debugging. This can be done by invoking <code>ctest</code> executable directly from the build directory, e.g. <code>ctest -R mpqc/validation/h2o-cc3-631g-np1 -V</code> will validate the job specified in <code>h2o-cc3-631g.json</code> using 1 MPI rank.</p>
<h1><a class="anchor" id="validation-guidelines"></a>
Guidelines for constructing validation tests</h1>
<ul>
<li>Most validation tests should have <em>short duration</em>, e.g. a second or two. Most validation tests should belong to this category.</li>
<li>In practice this may not be possible to make all tests have short duration. e.g. computations on 3-d solids even in a minimal basis are likely to exceed this limit. To indicate that a particular validation test is long-duration add <code>LongTest</code> to its name. E.g., CCSDT cc-pVQZ calculation on water should be named <code>h2o-ccpvqz-ccsdt-LongTest.json</code>.</li>
<li>Reference outputs for each test should be evaluated with <em>higher</em> precision than the target precision. E.g. if the test will expect energy precise to 1e-9 the reference energy should be computed to 1e-10 or ever tighter, to ensure that the deviations from the reference energy of 1e-9 are meaningful.</li>
<li>MPQC will by default try to guarantee that the target property (or properties) requested in the input file is evaluated such that its precision is better than the target precision specified by the <code>precision</code> keyword. In other words, MPQC tries to guarantee that the magnitude of the difference between the computed value and the "exact" value for the given <em>representation</em> (orbital AO basis, DFT grid resolution, integral factorization, various truncation thresholds of PNO methods, etc.), i.e. what would be obtained by eliminating non-representation numerical errors, is less than the target precision given by the <code>precision</code> keyword of the property object (see TaylorExpansionFunction class). Unfortunately sometimes the <em>actual</em> precision of the computed property value may be worse than the target precision. Failure to guarantee precision may be due to a number of factors, e.g., due to suboptimality of some algorithmic details, such as convergence checks. Indeed, in general it is difficult to predict reliably the precision of a computed result for most iterative solvers like SCF, thus typically precision is estimated by monitoring changes in the property (typically, energy) in the course of iteration. Algorithmic causes of the failure to guarantee precision typically exhibit themselves as systematic failures of validation tests. Of course, this implies that the reference result is sufficiently precise, hence the above recommendation to use the highest-possible target precision when producing reference outputs for validation tests. Unfortunately, sometimes failure to guarantee precision happens due to the unpredictable impact of roundoff errors (e.g., due to nondeterministic scheduling) and the effect thereof on iterative solvers. Such cases typcially exhibit themselves as <em>stochastic</em> failures of validation tests; for problems of validation-appropriate size this happens very rarely. In such cases it may be necessary to override the <em>estimated</em> precision of computed property value rather than assume that it is the same as the target precision. This can be done by specifying the <code>estimated_precision</code> keyword of Property object. Here's an example : <div class="fragment"><div class="line"><span class="stringliteral">&quot;property&quot;</span>: {</div>
<div class="line">  <span class="stringliteral">&quot;type&quot;</span>: <span class="stringliteral">&quot;Energy&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;wfn&quot;</span>: <span class="stringliteral">&quot;$:wfn&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;precision&quot;</span>: <span class="stringliteral">&quot;1e-7&quot;</span>,</div>
<div class="line">  <span class="stringliteral">&quot;expected_precision&quot;</span>: <span class="stringliteral">&quot;3e-7&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --> N.B. Keyword <code>estimated_precision</code> is not actually read by the property object constructor, and currently it is simply copied to the output to be read by the validation checker; in the future we expect the value of this keyword to actually be estimated in the course of the calculation, at least for some computation types. Hence this keyword is <em>reserved</em> for future use. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Nov 13 2025 23:43:46 for MPQC-Docs by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
